<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf8">
    <meta name="viewport" content="initial-scale=1">
    <title>digitle</title>
    <style>
        html {
            height: 100%;
            font-size: 24px;
            font-family: Ubuntu, "DejaVu Sans", "Bitstream Vera Sans", Corbel, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", sans-serif;
            background: hsl(215, 50%, 95%);
        }
        body {
            height: 100%;
            margin: 0;
        }
        main[hidden] {
            display: none;
        }
        ol, ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        button {
            font-size: inherit;
        }

        main {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 1em;
            box-sizing: border-box;
            max-width: 30em;
            height: 100%;
            margin: 0 auto;
            padding: 1em;
        }
        header {
            display: flex;
            align-items: center;
            gap: 1em;
        }
        header h1 {
            font-size: 1.5em;
            margin: 0;
            text-align: center;
        }
        header .-before,
        header .-after {
            flex: 1;
        }
        header .-after {
            text-align: right;
        }
        header button {
            border: none;
            background: none;
            cursor: pointer;
            line-height: 1;
            padding: 0.25em;
        }
        #board {
            border: 1px solid #ccd;
            border-width: 1px 0;
        }
        #board #target {
            margin: 1em auto;
            text-align: center;
        }
        #board #given {
            display: flex;
            justify-content: center;
            gap: 1em;
            margin: 1em auto;
        }

        #inputs-wrapper {
            flex: 1;
            overflow: auto;
            padding: 0.25em;
        }

        .num, .op {
            display: inline-block;
            font-size: 2rem;
            /* We don't know the full height of the digits but we do know we want at least 0.25em */
            /* of horizontal padding, so set that padding and use line-height to fill vertically */
            box-sizing: border-box;
            min-width: 1.75em;
            padding: 0 0.25em;
            line-height: 1.75;
            text-align: center;
            font-weight: bold;
        }
        .num {
            color: white;
            background-color: hsl(230, 100%, 40%);
            background-image: linear-gradient(to bottom, hsl(230, 100%, 40%), hsl(240, 100%, 40%));
            background-image: linear-gradient(to bottom, hsl(205, 100%, 40%), hsl(215, 100%, 40%));
            box-shadow: 0 1px 3px 0px #0009, inset 0 0 2px 1px #fff2;
            outline: 1px solid #444
        }
        .num.intermed {
            background-color: hsl(30, 100%, 40%);
            background-image: linear-gradient(to bottom, hsl(40, 100%, 40%), hsl(30, 100%, 40%));
        }
        .num.-error {
            background-color: hsl(0, 100%, 40%);
            background-image: linear-gradient(to bottom, hsl(350, 100%, 40%), hsl(0, 100%, 40%));
        }
        .num.used {
            background: #444;
            color: #ccc;
        }
        .num.intermed.used {
            background: #666;
        }
        .num.target {
            background-color: hsl(205, 100%, 40%);
            background-image: linear-gradient(to bottom, hsl(205, 100%, 40%), hsl(215, 100%, 40%));
            background-image: linear-gradient(to bottom, hsl(180, 100%, 30%), hsl(185, 100%, 30%));
        }
        .num.-pending {
            color: black;
            background: none;
            min-height: 1.75em;
            box-shadow: inset 0 0 0 0.125em black;
        }
        .num[data-index] {
            cursor: pointer;
        }
        .num[data-index]:hover {
            outline: 2px solid #222;
            filter: brightness(120%);
        }

        #target .num {
            font-size: 2.5rem;
            line-height: 1.5;
            padding: 0 0.5em;
        }

        .expn-list {
            display: grid;
            grid: auto-flow / auto auto;
            row-gap: 0.5em;
        }
        .expn-list > div {
            display: flex;
            align-items: start;
        }
        .expn-list > .-expn {
            justify-content: end;
            grid-column: 1;
            flex-wrap: wrap;
            margin-top: -0.25em;  /* counteract the wrap spacing */
        }
        .expn-list > .-expn .num,
        .expn-list > .-expn .op {
            margin-top: 0.25em;
        }
        .expn-list > .-eq {
            grid-column: 2;
            align-items: end;  /* makes wrapping very nice */
        }

        #keyboard {
            font-size: 1.5em;
            display: grid;
            grid: auto-flow 1.5em / 3fr repeat(4, 2fr) 3fr;
            gap: 0.25em;
            --button-hue: 215;
        }
        #keyboard button#button-reset {
            grid-row: span 2;
            grid-column: 1;
            --button-hue: 275;
        }
        #keyboard button#button-submit {
            grid-row: span 2;
            grid-column: 6;
            --button-hue: 155;
        }
        #keyboard button[data-type=erase],
        #keyboard button[data-type=done] {
            grid-column: span 2;
        }
        #keyboard button {
            border: none;
            text-align: center;
            line-height: 1.5;
            border-radius: 0.125em;
            border: 1px solid #888;
            background: hsl(var(--button-hue), 20%, 80%);
            background-image: linear-gradient(to bottom, transparent, hsl(var(--button-hue), 20%, 75%));
            box-shadow: inset 0 0 3px #fff4;
            cursor: pointer;
        }
        #keyboard button:hover {
            background: hsl(var(--button-hue), 20%, 85%);
        }
        #keyboard button:active {
            background: hsl(var(--button-hue), 20%, 70%);
        }

        /****************************************************************************/
        /* about */

        #main-about {
            overflow: auto;
            padding-bottom: 2em;
        }
        #main-about p {
            font-size: 0.75rem;
            margin: 0;  /* flexbox does the gap */
            line-height: 1.5;
        }
        #main-about .num,
        #main-about .op {
            font-size: 1em;
        }

        .about-examples {
            display: grid;
            grid: auto-flow / auto auto;
            align-items: center;
            gap: 1em;
            margin: 0 1em;
        }

        /****************************************************************************/

        @media (max-width: 720px) {
            html {
                font-size: 16px;
            }
            .num, .op {
                font-size: 1.5rem;
            }

            #main-about p {
                font-size: 1em;
            }
            .about-examples {
                grid-template-columns: auto;
            }
            #main-about .about-examples > p {
                margin-bottom: 1em;
            }
        }
    </style>
</head>
<body>
    <main id="main-game">
        <header>
            <div class="-before"></div>
            <h1>digitle</h1>
            <div class="-after">
                <button id="button-show-about">‚ùì</button>
            </div>
        </header>
        <div id="board">
            <div id="target"><span class="num target">???</span></div>
            <ul id="given"></ul>
        </div>
        <div id="inputs-wrapper">
            <ol id="inputs" class="expn-list"></ol>
        </div>
        <div id="error"></div>
        <!-- <div id="win">&nbsp;</div> -->
        <div id="keyboard">
            <!--
            <button data-type="digit" data-digit="1">1</button>
            -->
            <button id="button-reset">üîÑÔ∏é</button>

            <button data-type="operator" data-op="+">+</button>
            <button data-type="operator" data-op="-">‚àí</button>
            <button data-type="operator" data-op="*">√ó</button>
            <button data-type="operator" data-op="/">√∑</button>
            <button id="button-submit">‚úì</button>

            <button data-type="erase">‚å´</button>
            <button data-type="done">=</button>
        </div>
    </main>
    <main hidden id="main-about">
        <header>
            <div class="-before"></div>
            <h1>about</h1>
            <div class="-after">
                <button id="button-close-about">‚ùå</button>
            </div>
        </header>
        <p><strong>digitle</strong> is a number puzzle game, best known from the UK game show <a href="https://en.wikipedia.org/wiki/Countdown_(game_show)#Numbers_round">Countdown</a>.</p>
        <p>Try to reach the target number by combining the six given numbers and the four basic arithmetic operations.  Click on available numbers to insert them into an expression, or type them on your keyboard.</p>
        <div class="about-examples">
            <ol class="expn-list">
                <div class="-expn">
                    <span class="num">1</span>
                    <span class="op">+</span>
                    <span class="num">2</span>
                    <span class="op">√ó</span>
                    <span class="num">3</span>
                </div>
                <div class="-eq">
                    <span class="op">=</span>
                    <span class="num intermed">7</span>
                </div>
            </ol>
            <p>Order of operations matters.  You can now use this <span class="num intermed">7</span> again later.</p>
            <ol class="expn-list">
                <div class="-expn">
                    <span class="num intermed">7</span>
                    <span class="op">-</span>
                    <span class="num">9</span>
                    <span class="op">+</span>
                    <span class="num">10</span>
                </div>
                <div class="-eq">
                    <span class="op">=</span>
                    <span class="num -error">8</span>
                </div>
            </ol>
            <p>Negative numbers aren't allowed.  A hidden <span class="num -error">‚àí2</span> is created here.</p>
            <ol class="expn-list">
                <div class="-expn">
                    <span class="num intermed">7</span>
                    <span class="op">+</span>
                    <span class="num">10</span>
                    <span class="op">-</span>
                    <span class="num">9</span>
                </div>
                <div class="-eq">
                    <span class="op">=</span>
                    <span class="num intermed">8</span>
                </div>
            </ol>
            <p>Rearranging can help.</p>
            <ol class="expn-list">
                <div class="-expn">
                    <span class="num intermed">8</span>
                    <span class="op">√∑</span>
                    <span class="num">3</span>
                </div>
                <div class="-eq">
                    <span class="op">=</span>
                    <span class="num -error">2‚Öî</span>
                </div>
            </ol>
            <p>Fractions aren't allowed, either.</p>
        </div>
        <p>In rare cases, a puzzle may not be exactly solvable.  You can still earn half a point for getting within 5 of the target, or a quarter point for getting within 10.  Click the submit button when you're happy with your solution.</p>
    </main>
    <script type="module">
        import { UI, Game } from './script.js';
        let game = new Game();
        new UI(game, document.querySelector('main'));

        document.querySelector('#button-show-about').addEventListener('click', () => {
            for (let el of document.querySelectorAll('main')) {
                el.setAttribute('hidden', '');
            }
            document.querySelector('#main-about').removeAttribute('hidden');
        });
        document.querySelector('#button-close-about').addEventListener('click', () => {
            for (let el of document.querySelectorAll('main')) {
                el.setAttribute('hidden', '');
            }
            document.querySelector('#main-game').removeAttribute('hidden');
        });
    </script>
</body>
</html>
